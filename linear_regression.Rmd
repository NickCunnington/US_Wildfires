---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse) 
library(janitor)
library(modelr)
library(broom)
library(ggfortify)
library(infer)
```




# Linear Model for amount of fires per year.

### Testing hypothesis that the total number of fires has increased during the reporting period.


```{r}
# creating the linear model

model <- lm(formula = num_fires ~ fire_year, data = year_plot)
summary(model)
```

```{r}
tidy(model)
```

```{r}
clean_names(glance(model))
```

**The R Squared is quite low as expected from the widely spread plot and from the high p value we already know the model is not a good fit**


```{r}
# diagnostic plots

autoplot(model)
```


**The diagnostic plots agree that the model isn't a great fit and there is likely to be a curve in the best fit line.  As this is time series data we already know this is the case.**


```{r}
year_plot <- year_plot %>%
  add_predictions(model) %>%
  add_residuals(model)
year_plot
```



```{r}
# plotting the model best fit line

year_plot %>%
  ggplot(aes(x = fire_year)) +
  geom_point(aes(y = num_fires)) +
  geom_abline(
    intercept = model$coefficients[1],
    slope = model$coefficients[2],
    col = "red"
  ) +
  ylim(0, 120000) +
  ggtitle("Amount of fires per year, 1992-2015\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
  
```


**The plotted best fit line does show a slight increase, but as the P value is far too high I can not accept this model as a true representation of the occuring trend**


### Just to make sure I'm going to use bootstrapping using the same model


```{r}
bootstrap_distribution_slope <- year_plot %>%
  specify(formula = num_fires ~ fire_year) %>%
  infer::generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "slope")

slope_ci95 <- bootstrap_distribution_slope %>%
  get_ci(level = 0.95, type = "percentile")
slope_ci95
```

```{r}
bootstrap_distribution_slope %>%
  visualise(bins = 30) +
  shade_ci(endpoints = slope_ci95)
```

```{r}
clean_names(tidy(model, conf.int = TRUE, conf.level = 0.95))
```

**As 0 occurs within the 95% confidence intervals of -283 to +1075 it reinforces the fact that this model can not be used to explain if there are any positive or negative trends that are occurring in this data.  It will be more use to use a model that is designed for time series and seasonal variations.  For that I shall be also requiring more data points so I will now use monthly data and not yearly.**








# Linear model for checking change in arson related fires.

### Testing hypothesis that the total number of fires due to arson has decreased during the reporting period.

```{r}
fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Arson") %>%
  summarise(num_fires = n()) %>%
  ggplot +
  aes(x = fire_year, y = num_fires, colour = stat_cause_descr) +
  geom_line() +
  ylim(0,20000) +
  ggtitle("Amount of fires per year from Arson (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  labs(colour = "Cause of fire") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
#  Splitting data into individual dataframes

fires_arson <- fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Arson") %>%
  summarise(num_fires = n())
```


```{r}
# creating the linear model for arson

model2 <- lm(formula = num_fires ~ fire_year, data = fires_arson)
summary(model2)
```

**The R Squared value is quite low, but that is to be expected with those large peaks in the data.  However the p-value is reasonable so we could be onto something here.**


```{r}
autoplot(model2)
```

**No, a linear model is definitely isn't the best fit for the data, but we knew that was going to be the case anyway with those large peaks in the data.**


```{r}
# Plotting best fit line

fires_arson %>%
  ggplot(aes(x = fire_year)) +
  geom_line(aes(y = num_fires)) +
  geom_abline(
    intercept = model2$coefficients[1],
    slope = model2$coefficients[2],
    col = "red") +
  ylim(0,20000) +
  ggtitle("Amount of fires per year by Arson (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
# Not I'll try boot strapping as well.

bootstrap_distribution_slope2 <- fires_arson %>%
  specify(formula = num_fires ~ fire_year) %>%
  infer::generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "slope")

slope_ci95_2 <- bootstrap_distribution_slope2 %>%
  get_ci(level = 0.95, type = "percentile")
slope_ci95_2
```

```{r}
bootstrap_distribution_slope2 %>%
  visualise(bins = 30) +
  shade_ci(endpoints = slope_ci95_2)
```

```{r}
clean_names(tidy(model2, conf.int = TRUE, conf.level = 0.95))
```

**Bootstrapping works a lot better.  We can see that 0 does not fall between the high and low confidence intervals so I can statistically prove the hypothesis that there has been a general decreasing trend in Arson during the reporting period.**






# Now to model fires by Children.

### Testing hypothesis that the total number of fires due to children has decreased during the reporting period.


```{r}
fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Children") %>%
  summarise(num_fires = n()) %>%
  ggplot +
  aes(x = fire_year, y = num_fires, colour = stat_cause_descr) +
  geom_line() +
  ylim(0,20000) +
  ggtitle("Amount of fires per year by Children (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  labs(colour = "Cause of fire") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Splitting data into individual dataframes

fires_children <- fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Children") %>%
  summarise(num_fires = n())
```

```{r}
# creating the linear model for children

model3 <- lm(formula = num_fires ~ fire_year, data = fires_children)
summary(model3)
```

**As the peaks aren't as high as in the arson case the R Squared values are a lot higher in this model showing a better fit.  The p-value is also very small, which is a good sign.**



```{r}
autoplot(model3)
```

**Variations in the data do show that it is not completly linear.**


```{r}
# Plotting best fit line

fires_children %>%
  ggplot(aes(x = fire_year)) +
  geom_line(aes(y = num_fires)) +
  geom_abline(
    intercept = model3$coefficients[1],
    slope = model3$coefficients[2],
    col = "red") +
  ylim(0,20000) +
  ggtitle("Amount of fires per year by Children (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
# Now I'll try boot strapping as well.

bootstrap_distribution_slope3 <- fires_children %>%
  specify(formula = num_fires ~ fire_year) %>%
  infer::generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "slope")

slope_ci95_3 <- bootstrap_distribution_slope3 %>%
  get_ci(level = 0.95, type = "percentile")
slope_ci95_3
```

```{r}
bootstrap_distribution_slope3 %>%
  visualise(bins = 30) +
  shade_ci(endpoints = slope_ci95_3)
```



```{r}
clean_names(tidy(model3, conf.int = TRUE, conf.level = 0.95))
```

**The CI limits do not include 0, so the model can be used to prove the hypothesis that there is statistical evidence to suggest that the amount of fires started by children has been decreasing during the reporting period.**



# Modelling fire by Burning Debris

### Testing hypothesis that the total number of fires due to burning debris has inceased during the reporting period.


```{r}
fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Debris Burning") %>%
  summarise(num_fires = n()) %>%
  ggplot +
  aes(x = fire_year, y = num_fires, colour = stat_cause_descr) +
  geom_line() +
  ylim(0,27000) +
  ggtitle("Amount of fires per year by Debris Burning (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  labs(colour = "Cause of fire") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Splitting data into individual dataframes

fires_debris <- fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Debris Burning") %>%
  summarise(num_fires = n())
```

```{r}
# creating the linear model for debris

model4 <- lm(formula = num_fires ~ fire_year, data = fires_debris)
summary(model4)
```

```{r}
autoplot(model4)
```

```{r}
# Plotting best fit line

fires_debris %>%
  ggplot(aes(x = fire_year)) +
  geom_line(aes(y = num_fires)) +
  geom_abline(
    intercept = model4$coefficients[1],
    slope = model4$coefficients[2],
    col = "red") +
  ylim(0,27000) +
  ggtitle("Amount of fires per year by Debris Burning (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Now I'll try boot strapping as well.

bootstrap_distribution_slope4 <- fires_debris %>%
  specify(formula = num_fires ~ fire_year) %>%
  infer::generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "slope")

slope_ci95_4 <- bootstrap_distribution_slope4 %>%
  get_ci(level = 0.95, type = "percentile")
slope_ci95_4
```

```{r}
bootstrap_distribution_slope4%>%
  visualise(bins = 30) +
  shade_ci(endpoints = slope_ci95_4)
```


```{r}
clean_names(tidy(model4, conf.int = TRUE, conf.level = 0.95))
```

**There is some statsitical evidence that there has been an increase in debris, but it is slightly marginal.**




#  Smoking

### Testing hypothesis that the total number of fires due to smoking has decreased during the reporting period.

```{r}
fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Smoking") %>%
  summarise(num_fires = n()) %>%
  ggplot +
  aes(x = fire_year, y = num_fires, colour = stat_cause_descr) +
  geom_line() +
  ylim(0,20000) +
  ggtitle("Amount of fires per year by Smoking (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  labs(colour = "Cause of fire") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r}
# Splitting data into individual dataframes

fires_smoking <- fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Smoking") %>%
  summarise(num_fires = n())
```

```{r}
# creating the linear model for smoking

model5 <- lm(formula = num_fires ~ fire_year, data = fires_smoking)
summary(model5)
```

```{r}
autoplot(model5)
```

```{r}
# Plotting best fit line

fires_smoking %>%
  ggplot(aes(x = fire_year)) +
  geom_line(aes(y = num_fires)) +
  geom_abline(
    intercept = model5$coefficients[1],
    slope = model5$coefficients[2],
    col = "red") +
  ylim(0,20000) +
  ggtitle("Amount of fires per year by Smoking (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Now I'll try boot strapping as well.

bootstrap_distribution_slope5 <- fires_smoking %>%
  specify(formula = num_fires ~ fire_year) %>%
  infer::generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "slope")

slope_ci95_5 <- bootstrap_distribution_slope5 %>%
  get_ci(level = 0.95, type = "percentile")
slope_ci95_5
```

```{r}
bootstrap_distribution_slope5%>%
  visualise(bins = 30) +
  shade_ci(endpoints = slope_ci95_5)
```

```{r}
clean_names(tidy(model5, conf.int = TRUE, conf.level = 0.95))
```

**As 0 does not fall within the CI limits and the p-number is very small, there is a strong statically significant evidence that smoking has decrease during the period.**




# Miscellaneous

### Testing hypothesis that the total number of fires due to miscellaneous has increased during the reporting period.

```{r}
fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Miscellaneous") %>%
  summarise(num_fires = n()) %>%
  ggplot +
  aes(x = fire_year, y = num_fires, colour = stat_cause_descr) +
  geom_line() +
  ylim(0,27000) +
  ggtitle("Amount of fires per year by Miscellaneous (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  labs(colour = "Cause of fire") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Splitting data into individual dataframes

fires_miscellaneous <- fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Miscellaneous") %>%
  summarise(num_fires = n())
```

```{r}
# creating the linear model for smoking

model6 <- lm(formula = num_fires ~ fire_year, data = fires_miscellaneous)
summary(model6)
```

```{r}
autoplot(model6)
```

**Starting to get a few outliers**



```{r}
# Plotting best fit line

fires_miscellaneous %>%
  ggplot(aes(x = fire_year)) +
  geom_line(aes(y = num_fires)) +
  geom_abline(
    intercept = model6$coefficients[1],
    slope = model6$coefficients[2],
    col = "red") +
  ylim(0,27000) +
  ggtitle("Amount of fires per year by Miscellaneous (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Now I'll try boot strapping as well.

bootstrap_distribution_slope6 <- fires_miscellaneous %>%
  specify(formula = num_fires ~ fire_year) %>%
  infer::generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "slope")

slope_ci95_6 <- bootstrap_distribution_slope6 %>%
  get_ci(level = 0.95, type = "percentile")
slope_ci95_6
```


```{r}
bootstrap_distribution_slope6%>%
  visualise(bins = 30) +
  shade_ci(endpoints = slope_ci95_6)
```

```{r}
clean_names(tidy(model6, conf.int = TRUE, conf.level = 0.95))
```

**As 0 doesn't fall with in the CI limits and the p-number is very small, there is a strong statistical evidence of an increase in fires due to miscellaneous causes.**






# Railroad

### Testing hypothesis that the total number of fires due to railroad has decreased during the reporting period.

```{r}
fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Railroad") %>%
  summarise(num_fires = n()) %>%
  ggplot +
  aes(x = fire_year, y = num_fires, colour = stat_cause_descr) +
  geom_line() +
  ylim(0,27000) +
  ggtitle("Amount of fires per year by Railroad (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  labs(colour = "Cause of fire") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Splitting data into individual dataframes

fires_railroad <- fires_states %>%
  dplyr::select(stat_cause_descr, fire_year) %>%
  group_by(fire_year, stat_cause_descr) %>%
  filter(stat_cause_descr == "Railroad") %>%
  summarise(num_fires = n())
```

```{r}
# creating the linear model for smoking

model7 <- lm(formula = num_fires ~ fire_year, data = fires_railroad)
summary(model7)
```

**Noice**


```{r}
autoplot(model7)
```

**Looks like some outliers are present**


```{r}
# Plotting best fit line

fires_railroad %>%
  ggplot(aes(x = fire_year)) +
  geom_line(aes(y = num_fires)) +
  geom_abline(
    intercept = model7$coefficients[1],
    slope = model7$coefficients[2],
    col = "red") +
  ylim(0,27000) +
  ggtitle("Amount of fires per year by Railroad (1992-2015)\n") + 
  xlab("\nYear") +
  ylab("Number of Fires\n") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# Now I'll try boot strapping as well.

bootstrap_distribution_slope7 <- fires_railroad %>%
  specify(formula = num_fires ~ fire_year) %>%
  infer::generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "slope")

slope_ci95_7 <- bootstrap_distribution_slope7 %>%
  get_ci(level = 0.95, type = "percentile")
slope_ci95_7
```


```{r}
bootstrap_distribution_slope7 %>%
  visualise(bins = 30) +
  shade_ci(endpoints = slope_ci95_7)
```

*Outliers have skewed the distribution a bit at the lower end.*



```{r}
clean_names(tidy(model7, conf.int = TRUE, conf.level = 0.95))
```

**There is a statistically significant evidence that fires by railroad have decreased over the reporting period.**

